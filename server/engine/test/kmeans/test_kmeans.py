#!/usr/bin/env python
# -*- coding: utf-8 -*-

# インポートに絡むおまじない
import sys, os
sys.path.append(os.path.abspath(os.path.dirname(__file__) + '/../../main/common'))
sys.path.append(os.path.abspath(os.path.dirname(__file__) + '/../../main/kmeans'))

import unittest
from nose.tools import *

import numpy as np

import data_generator
from kmeans import *

from test_kmeans_base import *

from scipy.cluster.vq import vq, kmeans, whiten

class TestKMeans(TestKMeansBase):
    # 初期化できること
    def test_success_initialize(self):
        kmeans_instance = KMeans()
        assert_is_not_none(kmeans_instance)

        samples = self.create_test_random_samples()
        kmeans_instance.set_samples(samples)
        eq_(TestKMeans.SIZE, kmeans_instance.get_samples_size())

    # 学習に成功すること
    def test_success_learning_completely(self):
        kmeans_instance = KMeans()
        samples = self.create_test_random_samples()
        kmeans_instance.set_samples(samples)

        # 学習結果の是非については、ここでは確認しない
        ok_(kmeans_instance.learn())
        ok_(not kmeans_instance.learn())

    # 初期割り当てを指定して学習に成功すること
    def test_success_learning_completely_with_set_init_assigns(self):
        kmeans_instance = KMeans()
        samples = self.create_test_random_samples()
        kmeans_instance.set_samples(samples)

        # 初期割り当てを実施
        rand_assigns = KMeans.generate_random_assigns(
            kmeans_instance.k, len(samples))
        kmeans_instance.set_init_assign(rand_assigns)

        # 学習結果の是非については、ここでは確認しない
        ok_(kmeans_instance.learn())
        ok_(not kmeans_instance.learn())

    # 適切に学習されること
    def test_success_valid_learning(self):
        K = 3
        kmeans_instance = KMeans(k = K)
        samples = np.array([[77.3,13.0,9.7,1.5,6.4],
                            [82.5,10.0,7.5,1.5,6.5],
                            [66.9,20.6,12.5,2.3,7.0],
                            [47.2,33.8,19.0,2.8,5.8],
                            [65.3,20.5,14.2,1.9,6.9],
                            [83.3,10.0,6.7,2.2,7.0],
                            [81.6,12.7,5.7,2.9,6.7],
                            [47.8,36.5,15.7,2.3,7.2], 
                            [48.6,37.1,14.3,2.1,7.2],
                            [61.6,25.5,12.9,1.9,7.3],
                            [58.6,26.5,14.9,2.4,6.7],
                            [69.3,22.3,8.4,4.0,7.0],
                            [61.8,30.8,7.4,2.7,6.4],
                            [67.7,25.3,7.0,4.8,7.3],
                            [57.2,31.2,11.6,2.4,6.5],
                            [67.2,22.7,10.1,3.3,6.2],
                            [59.2,31.2,9.6,2.4,6.0],
                            [80.2,13.2,6.6,2.0,5.8],
                            [82.2,11.1,6.7,2.2,7.2],
                            [69.7,20.7,9.6,3.1,5.9]])
        init_centroid = [np.array([82.5,10.0,7.5,1.5,6.5]),
                         np.array([47.8,36.5,15.7,2.3,7.2]),
                         np.array([67.2,22.7,10.1,3.3,6.2])]
        
        kmeans_instance.set_samples(samples)
        kmeans_instance.set_centroids(init_centroid)
        ok_(kmeans_instance.learn())

        # answer is np.kmeans
        book = np.array(([82.5,10.0,7.5,1.5,6.5], 
                         [47.8,36.5,15.7,2.3,7.2], 
                         [67.2,22.7,10.1,3.3,6.2]))
        np_kmeans_results = kmeans(samples, book)
        answer = np.array([np.argmin(np.sum((d - np_kmeans_results[0]) ** 2,
                                   axis = 1)) 
                  for d in samples])
        answer_each_size = [np.sum(answer == k) for k in range(K)]

        actual_each_size = kmeans_instance.get_each_cluster_size()
        for i, v in enumerate(answer_each_size):
            eq_(v, actual_each_size[i])
        
        actual_assign = kmeans_instance.get_assign_list()
        matched_results = (answer == actual_assign)
        ok_(np.all(matched_results))

    # ステップごとの学習に成功すること
    def test_success_learning_step_by_step(self):
        kmeans_instance = KMeans()
        samples = self.create_test_mixture_random_samples(kmeans_instance.k)
        kmeans_instance.set_samples(samples)

        cnt = 1
        while not kmeans_instance.converged: 
            ok_(kmeans_instance.learn(steps = cnt))
            cnt += 1
            print kmeans_instance.get_assign_list()
            print [c.centroid for c in kmeans_instance.get_clusters()]

    # 途中経過を確認できること
    def test_success_check_learning_process(self):
        kmeans_instance = KMeans()
        samples = self.create_test_mixture_random_samples(kmeans_instance.k)
        kmeans_instance.set_samples(samples)

        print 'process...'

        kmeans_instance.set_random_centroids()
        print kmeans_instance.get_assign_list()
        print [c.centroid for c in kmeans_instance.get_clusters()]

        cnt = 1
        while not kmeans_instance.converged: 
            ok_(kmeans_instance.learn(steps = cnt))
            cnt += 1
            print kmeans_instance.get_assign_list()
            print [c.centroid for c in kmeans_instance.get_clusters()]

    # バグ #14対応
    def test_success_isolated_cluster(self):
        raw_sample_and_assigns = [[6, [-1.05143404481387, -4.220672329138018, -1.6718839676841268]], [4, [3.415153097881497, 1.742434623134556, -2.5342626728495588]], [1, [-1.5317028903989005, -2.220439530316913, 1.2457903653176217]], [6, [2.410239503318485, -3.4306305389857736, -0.12184809174644749]], [4, [1.4683906406622729, 2.5498465911451165, -2.113978278072752]], [4, [1.2010804752369868, 2.352525173947356, 0.9160098754385145]], [3, [-0.9127974676209466, -0.8990589336122743, -2.3667577678151743]], [1, [-0.4091385249283811, -0.6667444881953604, 1.0538701034805855]], [1, [-1.6365903694072201, -2.5054307130289364, 1.5416717561624522]], [4, [0.8368542341895135, 1.9077765558002675, -2.3052699559809824]], [4, [-0.8095569598693411, 5.838112125938203, -2.795428591691675]], [6, [2.5811002953688162, -0.8348013001115844, 1.3404557491810722]], [4, [2.987159146045805, 0.7995537553904886, -1.77491464173771]], [3, [-1.7893715303641575, -0.041719373811232675, -1.155455276177836]], [4, [2.393556256226836, 2.228181476919068, -2.4359030179320054]], [6, [1.4861566911709818, -3.313592144201483, -1.0152552639035912]], [6, [3.419010052579097, -2.9527131440341075, 0.010330195074790762]], [4, [-1.2661282911160858, 1.9925625123158444, -0.32403009044147374]], [5, [2.3849697789798157, 0.02536400951764474, 0.2902006715802083]], [2, [-0.8316553682296763, 0.23232709759043066, -0.24851496334850065]], [6, [0.368534210937431, -1.7609135312606754, -1.1145068871555415]], [3, [-1.0950078284086655, -1.3004983085401118, -2.6450136424378963]], [1, [-3.0751926971783585, 0.29672141491363896, 4.70716916197235]], [6, [-0.38792583081172866, -1.8507443068130438, -0.36455050550163515]], [1, [-0.3290956436184684, -0.9190859649630962, 4.122726403548963]], [4, [0.2997860335166873, 2.040011399017718, -2.300653352967685]], [4, [-0.3792168063646299, 4.849093283376173, -2.4821055268848053]], [4, [-1.6314546076618852, 1.2393589756322165, -3.2103400754721307]], [1, [-2.1024192180505517, -0.9152120471294135, 0.716221974715659]], [6, [4.480395494280505, -0.9216225155964161, 4.185138476243504]], [1, [-0.2675832088726526, 2.3790574562336926, 1.6942363779715823]], [6, [0.6704762372524228, -2.8687033066354717, 0.5400897478797128]], [4, [0.5666867607577643, 1.6698616615328068, 0.9755036153277329]], [1, [-3.0878965450677662, 1.7672242697746834, 1.3130382680548107]], [6, [-1.217762892395397, -2.339295560106202, -0.3251647900677361]], [4, [0.8498939793347607, 2.3547266019653526, 0.26500110905337343]], [4, [-1.4174010383612936, 0.8331891308486138, -4.525040765872497]], [4, [1.1141141763324862, 4.515687220256907, 1.497933760648575]], [1, [-2.615156694674195, -1.2366682806284188, -0.18017657658804226]], [4, [2.3282699214259424, 1.27810213753512, -1.1802820950072237]], [4, [1.5216732577688377, 0.1862177409946317, -0.9520850796055558]], [4, [5.383222140534554, 2.0232166493581345, -1.2084572647727454]], [6, [-0.4622752278029021, -1.9252160185547251, 0.4657966667651692]], [6, [-0.7583396941066112, -1.418829455965787, -1.3461008471634595]], [6, [3.3429790164451423, -1.5771478487543493, -2.8384456423350963]], [1, [2.201175148205212, 0.6735630332971753, 2.4011536227576813]], [1, [-1.661365807813334, 2.497738629543949, 2.59828960508767]], [6, [-0.8724726149894207, -1.575678249603215, -2.5477449181635876]], [1, [1.2391457268828459, -2.356717379202057, 4.420940780520656]], [1, [2.146249498341591, 0.372740398235974, 5.973519987547057]], [3, [0.6805115942174312, -0.9187106538841441, -1.9944744573759996]], [6, [0.7994901080208829, -1.626129251547548, -2.4549643426500554]], [2, [-1.7136845771034601, -1.1192410806186908, -0.5644727844760149]], [6, [2.286022217132297, -2.565830261747553, 4.182983047565708]], [1, [-4.022132710519834, 0.792904984798972, 0.35362328543938304]], [6, [3.484633505279005, -2.9185856528930016, -3.0014381639086207]], [2, [-0.7825676984568862, -0.6876601290743476, -0.2337143216606187]], [4, [0.4282260352298486, 0.3331927321538823, -1.994876753318668]], [6, [1.6207185045250347, -0.985874831636998, -0.44047653908572243]], [6, [0.3283837908420152, -1.18974338606167, 1.0880382098800785]], [4, [1.2164062385154688, 2.83424567297372, 1.6369012785146542]], [4, [-1.4452607605738899, 3.449473303124847, 1.021946381271831]], [1, [0.6986454565250467, 0.9594186337104387, 3.544851510572937]], [6, [-2.3318452016844877, -3.9687011443758773, -2.8767920130671905]], [4, [1.0028624540985636, 0.1894123907849477, -3.1715906421664255]], [4, [3.364453431809841, 1.2210151165776406, 1.6965194855407588]], [1, [-2.1836371960455314, -2.8557346829978623, 1.2870510737936807]], [6, [1.790333399756187, -6.6152456129844355, 2.3949647612425924]], [6, [-0.013075923963604732, -6.681213251671513, 1.1046514492338504]], [4, [5.311792363601383, 4.725178599468979, -0.1984175514433738]], [1, [0.5382460783676104, -0.7225808264194746, 2.3122095102494034]], [6, [1.0248278232952788, -0.8419728711460448, -0.7852170435488917]], [1, [-1.9684024245742107, 0.24790131958430628, 4.026918887450373]], [6, [2.126796183999912, -3.0120804638693066, -1.5871110396476744]], [1, [-7.955798227142105, -0.8301576320853048, -0.4750749436983048]], [6, [4.002547651925779, -0.779524796266539, -0.02142897802845914]], [1, [-2.428167552180939, -1.1807212582763158, 1.3487254150757115]], [4, [3.4762056601225493, 5.085245263872159, -5.380272565223674]], [3, [-2.828588387065728, 0.0112827042694358, -3.1570553154783503]], [1, [-0.5084507464133073, -1.5917584210052795, 1.3159554333418666]], [4, [2.556434065039077, 3.0237029194584353, 3.0297830404724233]], [1, [-1.1323427229454346, 3.815081620026047, 4.787721939594526]], [1, [-1.9556966486979082, -0.801227557900631, 1.2193530148793572]], [1, [-2.4241564859035063, 1.8246969540449893, 2.077862130822083]], [4, [-1.0866379295484845, 0.7385554639856353, -3.023621517425673]], [1, [-3.933661603491543, -2.4156551756791957, 1.2790170063514683]], [3, [-0.7664555713376449, 0.004997271889286383, -1.0546057857526436]], [3, [-3.5544270496922596, 0.2086025245658448, -2.9435967944482724]], [4, [-2.0269104963090743, 3.6156415531771153, -0.04769944299349401]], [4, [-0.023534071505662935, 0.3428649406739688, -3.964475190213574]], [1, [-1.3394833245684783, 0.3055000407765475, -0.2793165350940931]], [1, [-1.322726695789964, -1.0234758008765867, -0.16151511421946416]], [1, [-3.3977852734705043, 0.43031058869013694, 0.9628315527496951]], [6, [0.5316040605053566, -2.3527914502822775, 2.959423851905772]], [4, [3.5489904435110255, 1.0259660831033968, -1.054819642170374]], [1, [-3.3616859113267403, 2.097304849589393, 1.8207063274979105]], [6, [2.5968860564120306, -3.415081006637916, 0.28871305314391454]], [6, [4.649792079232243, -1.0609540749865722, 1.0023108364566928]], [4, [0.9827417999184281, 2.288874467306356, 1.0504542945654385]], [6, [2.9776444600971734, -0.5329761837571261, 0.9590568427635104]], [6, [4.240559424296338, -2.699055023336773, 5.428094553646875]], [6, [1.551979054720291, -3.1586011330004036, -1.0672959949611385]], [4, [-2.9806354653305984, 2.1161450482270543, -3.34688240960365]], [6, [2.0264892534971577, -1.01705388982233, 1.098536131619039]], [6, [1.556595676604803, -2.579484520522592, 4.245884196886034]], [6, [-3.309685045047121, -6.272653034566621, 0.6368538245728632]], [1, [-3.266471793186446, 2.542830739564607, 0.9079773316016856]], [1, [-0.5086356901296912, 0.8198859072357703, 1.6911276478262147]], [4, [-3.2508278197132867, 1.6708092927039468, -5.355109717343641]], [1, [-5.779925399609141, -0.05269048414807661, -2.2751501087876336]], [1, [-0.42714013027448755, 0.5528413434949631, 4.273548278374381]], [4, [-3.659689582018175, 2.071275046580547, -1.9567588753641965]], [4, [3.86208053577404, 0.31293376494868075, -5.155898150762672]], [6, [3.3014490842859776, -3.102878498886179, 3.039792490800166]], [5, [1.321367500755235, 0.4140782219888586, 0.4940676184946989]], [6, [1.86147207465734, -3.1842672957674765, -3.5173337369135793]], [4, [1.4056831980394133, 4.655970143768663, -2.5927637932384835]], [1, [-2.060701594718541, 0.7814793730455538, 1.2156432161672261]], [6, [0.9146669861611041, -1.1147804822500593, -0.08234924755087648]], [1, [-0.7271945163020689, 0.19553916829775933, 0.7246050684036823]], [1, [2.7755222585631576, 1.078631035472391, 4.435454242000755]], [1, [-1.8555316672966249, -0.8345370078554071, 2.773957360942263]], [1, [-2.9568658700483015, 0.012542454651798615, 0.4087478843434068]], [1, [0.5726542788757387, 1.2390761628725575, 1.188217324439064]], [1, [-3.0850479384722878, 0.8703042613864985, -0.11572722247605703]], [4, [0.5546586115810694, 4.418179564573927, 1.2935877362394146]], [1, [0.41418114220452434, 0.4961993075317159, 2.084621384083024]], [1, [0.13310435414910526, 1.354243918068409, 3.0184746474226998]], [6, [3.721826674858585, -1.3745895321763557, 0.799883842967512]], [1, [2.868382811242668, 0.5272750002394685, 4.853833873561867]], [6, [1.696374374899516, -1.8435171570810325, 3.2133470119075516]], [4, [1.1894130635863447, 0.06648203172061733, -1.8745260749696968]], [1, [-1.4277908876245302, -0.16702489823596942, 1.9432346648778465]], [1, [-0.6401669529299439, -0.04014653285768697, 2.834021753985499]], [6, [4.991865404857096, -2.870244992794237, -0.6133118192658403]], [1, [-0.7802477120896532, 2.4671323988135025, 3.9743863323473088]], [6, [1.4072892823845387, -1.467303623711647, -2.5986617918073147]], [1, [-0.9874715184405237, 0.41203008631221233, 2.088401319658936]], [4, [-0.6524198803930807, 4.122740617266857, 1.0114245711713656]], [6, [2.2649137680485585, -0.45196219059795933, 1.2080222219239056]], [4, [-1.5768670992155613, 1.2867804237060083, -4.487197943901135]], [5, [5.568906376518364, -0.07512550317201494, 4.822063103424983]], [6, [-0.9010085818172918, -1.661918243822524, -0.6270220775939492]], [1, [-0.9105194212956773, 1.041497095978197, 1.3285672361671368]], [4, [-1.1679160126456851, 1.3603626252586067, -1.6803056135674863]], [1, [-1.6754233767532958, 0.05979179732649502, 0.31800382023781554]], [4, [1.7691746282104446, 1.413521040342285, 1.907642205732331]], [6, [-0.5561856573263169, -5.109968813653335, 3.364048263861767]], [1, [0.04481139564446014, 0.6461546411109939, 6.089777657087225]], [6, [1.8514013635292303, -1.2954791434171042, 1.5451230169425436]], [3, [-0.6363860893162862, 0.3448612303145807, -1.5251430862681798]], [6, [-1.3171875471375083, -2.2743687811979534, -2.536740627836349]], [6, [0.7667270823083854, -2.2398622994332076, -1.2116707005486824]], [6, [-0.5182128489621048, -1.2498606985604614, -1.4148829345331841]], [3, [-2.2497198748004976, 0.022101674045325675, -2.413043433456613]], [6, [3.3519227314307427, -1.2616892836499172, -1.6965138521201464]], [3, [-0.9013282477167691, -1.6330239819588486, -3.2163470293586647]], [1, [0.5830854976221967, -1.2962301019313271, 3.1209513083438694]], [4, [-0.09532788128646816, 2.594284718542019, -4.31046167904052]], [6, [-1.4706715702915731, -4.329879461727551, -3.644299175123421]], [1, [-2.57089251264482, 4.156822765247908, 2.5177891053501207]], [3, [-0.9074458189494827, -0.7074886867826383, -1.7857940860394754]], [2, [-2.0018724756463717, -1.244676185926868, -0.6534132943150573]], [4, [0.7358543497297629, 0.7707969344156013, -0.45202838140621626]], [4, [1.3324855311634611, 2.1199586288772796, -0.7106299194173511]], [2, [-1.5378427495321325, -0.3140488741813761, -0.7380785279188153]], [1, [-3.868797836197568, -0.6440522197015534, -0.32736031197982496]], [2, [-3.3328766806875403, -0.2847397587712758, -1.6933427977707551]], [4, [2.9077008747194695, 0.22089664774466536, -1.747519453631945]], [4, [-1.4061115885855593, 2.7395812532589483, -1.2520417043627763]], [1, [0.6730332494614895, 2.3812569559243353, 3.09043877279085]], [1, [1.106716174645801, -1.4837503000217376, 3.908047147498147]], [5, [1.7345659169671752, 0.37470645807080033, 1.8968296642988447]], [1, [-0.21914776603030725, 3.0761037365227004, 3.7087039125408947]], [4, [2.2489104831176867, 3.357435162998223, 1.3354993553711918]], [4, [2.4738113906241033, 5.3156495470361405, 2.2334316699475507]], [4, [-0.4899466920238752, 3.254337831775283, -1.5539250056726992]], [6, [0.47157216162968074, -0.7163883758685483, -0.863016264619073]], [6, [3.1840350667903556, -0.5353250384742593, 0.37253535239403646]], [1, [-2.4528185127724416, 3.613634485633899, 2.2933632511640574]], [6, [3.889437464699962, -1.6614593158955715, 1.6541942291880365]], [3, [1.2940207685875411, -0.6753210826137527, -2.545433935263329]], [5, [2.7335557245985918, 0.1879411809922513, 0.7830742876822469]], [6, [1.8445772728662921, -4.629329997612518, 3.3285563675497962]], [4, [3.905053022122321, 3.7399089000814274, -2.4961954887659537]], [6, [0.8941014097431591, -1.8307220575246208, -2.793382197778515]], [3, [0.8524804383502204, -0.546872272300448, -2.3444693196115782]], [4, [-0.319888069488888, 0.8109618784390572, -0.6003503766920977]], [4, [-0.5957987124421109, 2.093106190378986, 0.8627183257973223]], [1, [0.04283873076025025, -0.14858772719530083, 0.9408912839360558]], [1, [-1.5260823605966538, 0.007435680530979095, 2.647185770640567]], [1, [-0.6380546769823753, 2.080846174057857, 3.290911383421693]], [3, [-1.8647953172470615, 0.6187538513506728, -0.6062210590311812]], [3, [0.40297539463686066, -1.7001451722842018, -4.889844483916714]], [4, [0.22131126915633095, 1.4032351860930443, 0.31184108443219805]], [6, [1.5619421450201025, -0.3423643416759451, 0.3822309260742444]], [6, [1.496012177481094, -2.879436112850494, -0.44647446587103234]], [2, [-2.54641772704975, -1.5662439987843157, -2.84475135899552]], [4, [2.295224684760185, -0.13621552000494705, -3.0321884161341246]], [1, [-1.2428267516774332, 1.1442341805572533, 2.961938440778599]], [6, [0.41537528882799646, -1.11496212027458, -0.7094422168460567]], [6, [2.3998840814093083, -1.3190288354292117, -2.9611608659954864]], [6, [6.262153038339375, -0.6212034972826209, 0.161098330141017]], [1, [-0.5890823505075692, 1.4936569437919183, 3.435956991289709]], [4, [2.719795226325401, 2.5411582373024375, 0.9200561254206058]], [4, [-0.9025283214340022, 2.425676831296523, -1.7971269762257713]], [1, [-2.4817393000202563, -0.05674336972689423, -0.6383512901280911]], [3, [-2.026963356859076, 0.1873123068177821, -1.793273334177367]], [3, [-1.3081229969065788, -0.7019025758916899, -2.879194469803239]], [4, [4.21203519291361, 2.215648930513561, 0.24421742564045335]], [6, [3.9445598095719063, -0.7840350663329436, -0.03517595280234488]], [3, [1.3894782846013964, -0.8869623308062541, -3.1141218761866414]], [6, [-0.33213447107746996, -3.747607122783813, 3.3536138116283034]], [3, [2.162898062493462, -1.780444565816694, -5.532361115915049]], [4, [-1.0506717920376956, 3.586333176519779, -1.6861826827076876]], [6, [1.090255677192388, -1.595505005951121, 0.9037666963869982]], [3, [-0.5256998796599395, -0.20177876658407656, -2.317799310515666]], [1, [-2.6380211212810187, -0.9770233531586824, 0.12476066007571018]], [4, [-0.011916648811871983, 1.0400611300637421, -0.9758346529780875]], [4, [0.9002261878902691, 1.2935103522278075, 0.9371379317416083]], [1, [-4.948320941812551, 0.6280404995083386, -0.18399570439170726]], [6, [1.8592843451760839, -1.2881540692455187, 1.854767436556732]], [6, [0.799366599155445, -0.572355661727526, 0.9467303677089074]], [1, [0.06373212241938976, 1.3635008861189462, 2.686796345643305]], [4, [-1.2165229323023123, 2.84229738814163, -0.4496720987546237]], [6, [2.3752075927862464, -1.0582765291968517, 1.1573118286899007]], [3, [-3.0321311242448488, 0.5165115541374617, -2.7103186159130086]], [2, [-3.529335653252007, -0.8984727767573333, -2.4789323699751677]], [1, [-4.532169066507765, 1.6709483503044198, -0.12944017782879258]], [3, [0.9264988013531797, -1.3652634636843366, -3.0945445085540992]], [1, [1.314737126091834, 0.08558750764949614, 1.5946679926779277]], [4, [-0.5539654870979104, 1.9564890956989922, -2.088535512821699]], [3, [-0.2197706932393407, 0.3223490210562754, -0.4839395718818451]], [4, [2.1823125347982204, 0.901660017592622, 0.7561491468853746]], [1, [-1.055071995266634, -2.07493405073137, 2.3192798216274304]], [6, [1.3755314135090888, -0.7142459896162805, 0.017758839802741695]], [1, [-0.8153717900164162, -0.7240856177681957, 2.3124516138299933]], [5, [4.01615481978694, 0.4051012153681535, 0.8081262894527363]], [3, [-0.0026135098894887023, -0.076896041856441, -2.20332550755327]], [1, [-2.170473154416565, -0.9126611414948712, 0.4932909251958127]], [6, [0.3603114619639031, -2.9267156254734776, -0.8556660769586516]], [6, [3.094334572849365, -1.8980991444021977, -2.046731747899169]], [6, [-0.28233965614567924, -3.88762171594691, -3.0537928438664017]], [6, [2.253074882179582, -1.6512181434477364, 1.1916148693928699]], [1, [-3.735666827181378, -1.524185625691942, -0.028932078716298156]], [4, [4.178816959431904, 2.3849600747048525, -2.543119417275928]], [1, [-2.5225643878236785, 4.386887550284681, 2.765926965288067]], [1, [-0.8122452373857281, -1.2016457526404862, 4.682010315417902]], [4, [-2.055396091290272, 3.350090265522952, 0.6568397993756429]], [4, [1.4083465209404598, 0.29133889133794394, -1.9562036818417452]], [4, [-0.7161606001663683, 2.607275214221694, 0.33722527974035005]], [1, [-1.7888705573663517, 1.3076151229425876, 2.8442925829661525]], [1, [-1.4443260451290811, -2.163995750711187, 1.209804627614977]], [1, [1.443983546560617, 2.8213031347664552, 4.81411023145099]], [6, [0.934152328421684, -1.7872215760214976, 0.010175435093149679]], [1, [0.040881309929914456, -0.932484634211457, 1.3863743811090854]], [1, [-1.758282921965388, -0.4447426627518227, 1.1858598661595106]], [6, [3.3418493561900946, -2.9944556491183314, -0.8844833750683271]], [6, [0.8301291183734675, -4.05093932248943, -0.49998110917373156]], [1, [-0.1617633419933653, 4.035634972359003, 2.7406735896237624]], [1, [-0.629838758908562, 1.563350109941178, 2.1722634843555197]], [4, [2.450827167183165, 0.13649395175277218, -1.94652289931125]], [4, [1.054270600975969, 0.6859029163813816, -3.25839087355871]], [4, [-2.2538923718095405, 1.7039579772776454, -1.857940834097962]], [6, [-0.37142244041129235, -4.637183618284401, 1.6041020445590455]], [1, [-2.369034523595337, -0.06267537577542359, -0.5230463456756482]], [6, [-3.6808463780041003, -2.9959831930975547, -0.9564269146194687]], [4, [2.4844273743298713, 4.12833362583409, -0.28012265312856044]], [6, [1.1618154388343096, -2.9932399307359367, -1.2663148421985422]], [4, [-0.08810993325496601, 1.647322563245463, 0.24621621595636056]], [6, [2.1993046838684522, -3.5695150033811305, -1.2750224595270407]], [1, [-0.42707894202351165, 0.48000964777316185, 2.9988457024123236]], [1, [-3.3484955456487215, 0.745499950141147, 1.212549658607038]], [4, [1.7413412006427669, 1.6486307031380663, -1.8329400535021385]], [4, [-1.1543507553256627, 1.3566051029333615, -4.250320956822223]], [4, [3.7729547297112047, 0.6748358639474688, -1.2805530605924744]], [3, [-1.3310100286069444, -0.5652210027165935, -4.446678323145507]], [1, [-4.95753756171271, -3.3936037500455964, 0.2182986586432178]], [4, [1.198314224925102, 0.603961982166348, 0.08909426009945062]], [1, [0.8558615020720647, 0.6201577142835387, 1.7886591073549585]], [4, [-1.0096995238654112, 3.6863333567532397, -2.249104445967256]], [4, [1.3222929236254741, 3.229306852614103, -1.1303357296671497]], [3, [0.039076850716789256, -0.2870771720784135, -2.8076521356068493]], [4, [4.636875367006775, 3.17958012148226, -0.5017790839030686]], [4, [-1.4920742167097543, 1.0392631642656207, -0.7245098394164355]], [3, [-4.500307695391228, -0.13073296440486148, -3.1453984905377785]], [6, [-0.8184587924428226, -2.4387266646604626, 0.7634048578219356]], [6, [-0.5989110650772121, -0.9067124868212482, -0.8839334601608122]], [6, [-1.798826385740202, -4.0591668595099515, 1.7129124816850705]], [4, [-1.8144004874174466, 3.5760484271166746, -2.534788214768098]], [1, [-3.1577089013706257, 1.765812881331263, 2.2891683720893377]], [6, [2.375324727614289, -2.872422996405797, -2.7365124772538216]], [5, [3.4558164377860163, 0.18281165821475112, 0.6457259781153948]], [4, [1.3658466905397153, 2.9804499772932993, 0.46756563721548516]], [6, [0.3184340282653937, -2.388916361240978, 2.2120151178389134]], [4, [-1.533440694087822, 4.325601105480305, -3.719420024425543]], [4, [-0.38551838247527503, 1.2971284679207395, -2.1273201347948834]], [6, [4.253530740439147, -3.3014641239489566, 0.09655933779517227]], [1, [-1.7619617219080355, -2.2202291804981336, 5.155737927114523]], [1, [-0.7774772650090004, -0.7204395881003253, 1.7126025507744125]], [1, [-0.9241106035507238, -0.12639993015846834, 2.8214606574553995]], [1, [-1.8339990209427561, 1.4945707330389306, 1.3660467560221585]], [2, [-3.6417942418641545, -1.7828461213669193, -2.4584662253193885]], [6, [2.2336266857935834, -1.9012547249528005, -0.6724773331134439]], [3, [-0.7442494596342439, 0.3662710235275429, -1.855130386133766]], [1, [-2.8638695841405037, 1.632400207258585, 1.1198792927414722]], [1, [-0.43802624906548143, -2.7680769888753747, 4.839338733961304]], [1, [-0.15764890973173354, 0.4539683690519745, 1.8766409034787392]], [1, [0.09139671602099143, 0.3328811855913014, 4.850547345814534]], [1, [-1.2041827284334392, 2.8037241417644414, 3.5390784942562807]], [6, [0.8218247311829053, -2.096050009520506, -0.02081684536879241]], [6, [0.42445272806084494, -0.9882705035834228, 1.1471106590001217]], [6, [-0.39279503002630767, -6.472974792956369, 2.8539872045587797]], [1, [-2.535635979887073, 2.3186642073187698, 0.3845099858355723]], [1, [-3.999119016352823, 4.239160821125562, 3.5442394574931213]], [3, [0.7751945011908543, -0.2905177813042719, -2.5044763446505103]], [4, [0.5904776851174278, 1.2348902002148123, -0.0359394037471362]], [1, [-2.1206467467513606, -2.027939766311942, 0.7816021328703076]], [6, [0.7586998816090834, -0.8397326097420892, 0.39810082205002645]], [1, [-0.12819680306073913, -1.9587707907628462, 1.9157676110472586]], [4, [-0.6045139986722686, 0.8544391748130674, -1.7348645216572753]], [6, [0.6387959505662114, -3.6571064534831863, -0.9819133758665017]], [6, [1.150057136006449, -3.0349309203164427, -2.6689995223017853]], [4, [4.299220912666398, 0.5007961101808781, -1.9161195129391742]], [4, [-0.16574094325067604, 0.45858728609975, -1.6762799494629625]], [6, [0.2611465976107622, -1.6596847132786707, -0.7661929096741559]], [6, [3.00842977438858, -0.9511708498359146, 2.715174813889424]], [6, [3.2998595423285195, -0.6093330850859889, 1.7066304591802544]], [4, [4.40519625881778, 0.6528641053944351, -2.8336210361330245]], [4, [0.8015048685942562, 4.307245678145181, -0.33283109565267405]], [6, [2.6805297119869156, -2.4528641891190834, 2.0475510143855833]], [5, [3.203549613186072, 0.28101581932479397, 0.7681515842270632]], [6, [-2.6513761771008824, -3.723187479344231, -3.2166894196105646]], [4, [0.010363091011180893, 0.23957656791180584, -1.926137865064786]], [1, [0.32332422854590964, 2.440399171244823, 6.261706288225958]], [1, [-0.58662787536947, -0.1581765537260147, 1.1036969227901907]], [6, [-0.590468827772882, -2.0734883833211484, 0.36530286661432715]], [6, [-2.4815434634759015, -4.722988570248237, -1.646903839759637]], [4, [2.1982496016629804, 4.74800694215048, -4.108057208224291]], [1, [-2.127922071061391, 1.223101252241883, 2.681959917468359]], [1, [-1.0840491715074863, -1.5214620615447356, 1.8963036528632944]], [4, [-0.8098783895704402, 2.750924742838959, -1.572294602175395]], [4, [2.9812109261437127, 1.86025277931973, -0.6468345779878364]], [4, [-2.090822541128558, 4.055345946142252, -3.4732349333130257]], [4, [0.2266685724734018, 3.106723910528977, 1.3096233366907182]], [4, [0.0490431962272174, 1.35095314299007, 0.2894258832901742]], [1, [-0.8993930487910482, 0.12619181478594527, 1.1604286249270244]], [6, [0.5606875359040872, -0.6265049406814723, -0.06943648461734862]], [4, [-2.2323833122817973, 2.0963933504861747, -4.483016720403007]], [4, [4.599742049327154, 1.4177596920907312, 1.228346283997906]], [1, [-0.20468854796871686, -0.325120252394332, 2.037875415276543]], [4, [0.05729690815108988, 0.4076391145470607, -3.15223927667235]], [6, [0.15320176676073155, -3.4582541494723418, -2.115316772537307]], [1, [-2.584135936079704, 1.0944547515580165, 3.541825758198558]], [6, [0.13267676204285717, -3.260676847981046, -0.7405372259480819]], [4, [0.46930786345365383, 0.4331056288350287, -0.7299775373182599]], [1, [-1.2654428335149892, -1.533211632016656, 0.6043547264947339]], [6, [2.6479495919491796, -1.3449945297020136, -1.9845873150482753]], [3, [-0.6857072852048631, -1.396937870561813, -4.891171267861711]], [1, [-3.1721809356689, -1.2092829675578631, -0.04317256619136867]], [6, [1.9906626881736966, -2.3081380509636067, 2.688041992635717]], [6, [1.78996401703402, -0.4295156691844125, -0.8620671601757868]], [4, [3.4085450147202114, 1.1844853240047615, -2.8465762468443034]], [1, [0.08427958348202752, -0.3602448193500761, 1.1210112247680621]], [1, [-4.694677565763689, -0.5129224001843754, -0.6468367949933789]], [1, [-1.5908966599618994, -0.21343792285350266, 2.6352658156162305]], [4, [0.5496125727851897, 4.103880838450498, 2.3114925076952892]], [4, [-0.20956931091157346, 2.5733836061556725, 0.1750646658110664]], [1, [0.17556619455743466, 0.6459459329770528, 1.9258551678689566]], [5, [1.608782223893621, -0.022109472901459003, -0.43126167372341767]], [3, [0.6088271134894597, -0.6406251410559353, -1.6113985473169075]], [6, [-1.0785623042303065, -2.61151535859252, 0.7710099246064286]], [6, [1.221099099227917, -1.0614501214283876, -0.9363613199210196]], [3, [-1.8566050345169447, -0.26879963040539523, -1.5552669143195077]], [6, [5.978944764694236, -2.3318260514183655, 0.7764340242931564]], [1, [0.7305987037716555, -1.5405378764701443, 5.343840355590156]], [1, [0.6625000326100909, 0.6199551418697556, 2.0898631140092974]], [1, [-3.2623658589679643, 0.11588052154569786, 2.249324545670221]], [1, [-0.8746305815176949, -0.7642073570478073, 0.955499237130499]], [4, [2.2032576526388348, 0.7062187186967044, 0.8045181740317937]], [6, [0.8677204546180212, -3.794894361885452, -3.028982910906209]], [6, [-0.7405983872238178, -2.7490404775077364, -1.758650359523157]], [4, [0.30706049795455004, 1.07567605978041, -2.0706444789054848]], [3, [-4.247141510953471, 0.22695109039557795, -3.21598414316236]], [4, [0.602892878286249, 2.559706434575436, 0.0169005400355922]], [4, [1.877773624795631, 2.268854252991367, 2.1118500381396004]], [4, [1.8564192074402275, 3.0462908739256402, -2.57251641884191]], [4, [1.5837985782520045, 1.839104067730673, 1.8593395869056364]], [4, [1.1419588781817296, 4.8804733711660235, -0.4561972228447988]], [4, [-0.22223992283260222, 0.4008780393870968, -2.0100809376699176]], [6, [-1.5176081471091432, -2.944068300068706, 1.0050159069434192]], [4, [1.6221171719205725, 1.2464615203749978, -1.9543590206077053]], [6, [0.5563517874460351, -0.4583523720819155, 0.23352838959101602]], [1, [-0.18879829850310906, -0.844473435396969, 0.8140052639461574]], [6, [1.357978863090475, -1.9554005781305306, 0.6234320752821617]], [2, [-3.1777836863425684, -2.4652301377819263, -3.653742655466895]], [6, [1.5973393451329774, -1.218900660890509, -0.00032579276058740885]], [4, [2.631908699971368, 2.170712877429682, -0.8184477810726974]], [3, [-2.993860483845559, 0.7362451500905293, -2.4812812508054707]], [4, [1.9646799923391023, 1.5491333120637238, -0.45501211723064966]], [4, [-1.669874094616816, 4.492029262529411, 1.5166577615545513]], [6, [0.015631508718026633, -2.2630897714547507, -1.7995494874599238]], [3, [-1.4062544130522165, -0.22864385689874908, -2.858805043293471]], [1, [-0.4121415370537589, 3.439429127867103, 3.011126244737642]], [3, [-0.20682321896159803, -0.28942516495449533, -2.6059120060993033]], [1, [-4.162224402580635, 0.8885851776103945, -0.30706816915200363]], [3, [-2.970374652395145, 0.6675151562712284, -1.6376480183080224]], [5, [0.5442158704264519, -0.20386231095882815, 0.37321290799309204]], [4, [1.0939067897496877, 1.3559620986796739, -0.8246634634489481]], [1, [-2.731341939152653, 2.3663991735488303, 0.2020671865649422]], [4, [-3.6132779645128146, 1.4961948548577162, -1.9114575636355235]], [6, [2.007144982566627, -1.885166881130043, 0.7276113854773072]], [6, [0.9111481577397806, -1.4745087461795645, -1.6815432559130983]], [1, [-2.9096558530383794, -0.4756656768397485, 1.7920717459839148]], [4, [0.5258239273588599, 2.593618319000328, -4.317776155966503]], [1, [-2.663266322398254, -2.1305310843738834, 2.176709311441761]], [6, [2.0143837436095806, -4.545412545192001, -3.9205064860611833]], [4, [-0.3371159326664339, 1.3323088874216193, -3.2385816476766514]], [1, [2.0239832884918156, 0.33109493689815445, 3.76258027546984]], [3, [0.28939485213983335, -0.2016931211038331, -0.8367185475637289]], [6, [-2.7918118020578073, -3.5824269939875193, -3.3179557682971113]], [4, [-0.13637954360254406, 5.6466160042477975, -0.00708613162918138]], [6, [-0.40843068467443217, -2.3006798133070365, 1.0754175760276579]], [4, [1.968481609836866, 2.5180202468689457, 2.2040481272805175]], [1, [-1.6981966195227387, -1.9157688191482414, 2.476351073076371]], [4, [-1.3308855532243609, 2.07787834792365, -0.7885152298966559]], [4, [-0.07003680961969143, -0.3620867566428272, -5.5609307380901525]], [1, [-1.57605179883429, -1.0438714426451052, 0.15510070095385445]], [1, [-3.335116445486329, 1.533589409078671, 1.668484473603603]], [4, [2.3795952890346004, 0.6733904170219498, -0.13013005056652976]], [4, [-0.6113375979944664, 1.1490157556448886, -2.8634900039132543]], [6, [2.1856921595607943, -0.770372366213562, 0.21258566604840504]], [1, [-0.29147319109156666, 1.148807991920149, 0.6706255954701132]], [4, [-2.7695994042884995, 3.2390972329021483, -1.091715876867302]], [6, [3.341937931174832, -6.287422484213144, 1.3899746877117953]], [6, [2.834319086797239, -2.869106735664771, -0.1736501298634558]], [4, [-0.7588039545225171, 4.242285677294756, 0.7028750919731013]], [6, [-1.4424854616281124, -2.394754569051723, 0.33705879910181163]], [4, [1.487547548363622, 2.518200966140313, -0.47914312364263034]], [4, [-0.9335930566039633, 4.091860566793114, -2.4969347838435283]], [6, [3.0122576143272553, -2.7626061377359394, 1.5704440187624034]], [4, [0.3303250384025462, 0.759453487237984, -1.3379695003324903]], [4, [2.6122979742796404, 1.7485297740204273, -1.9485878747856622]], [4, [-0.39076110195640806, 3.318551242741868, -0.9032087838565989]], [6, [-1.109042417490689, -2.5786520374387374, -1.1193327542781755]], [6, [-3.390064361215976, -4.887416803496111, -2.5014155842389267]], [4, [0.9674436944127517, 1.142204600843619, 0.13081535100523245]], [3, [-4.184337289584116, 0.37900269212893084, -4.185565703806206]], [4, [3.9653549523933163, 2.9066997150063925, 0.69313538765175]], [6, [-2.80573828148798, -4.3711807990112534, 0.7506470303550122]], [1, [-3.126250308599385, -1.1183178994278449, 1.084703561475907]], [4, [-1.9802699134387975, 2.7659914080137233, -0.7958817963051504]], [6, [-0.8943998085818793, -4.227765392500389, 1.261628508066314]], [1, [0.8624833572372171, 2.257864204247529, 4.732537072465027]], [4, [0.229188402717608, 3.491139970455639, 1.0502715338161717]], [1, [-3.3347961858165913, 1.1780205856142512, 2.303973292765287]], [4, [3.8625045825120927, 2.2869963563163336, -3.8565229930484146]], [4, [-0.8553676994988373, 1.908206466160846, -2.1266102286389525]], [4, [4.667254765020149, 3.144975101731496, -1.7913487866226196]], [5, [3.0992996787584004, 0.9803264344489774, 3.1851142279272713]], [6, [-2.1925063950820456, -2.969295178317491, -2.1186344777881225]], [6, [-1.9154800868940256, -3.736324607694981, -0.709702811317965]], [6, [-2.2064138660609762, -4.213973738214608, 1.572178116467432]], [3, [0.38605089769053186, -0.15385009786745754, -1.6042202211170276]], [4, [0.995787870697569, 3.438238147947454, 0.9666652118386023]], [6, [5.292909735264528, -1.410973489343692, -0.11487777489310337]], [4, [2.152850498717623, 5.552734732269367, -0.897940059194355]], [1, [-0.9868736864232301, -1.939536559210313, 1.5125964658147735]], [6, [0.2636782170736793, -4.801505265324121, 0.4435693158959009]], [4, [-0.8866144138138466, 1.397400303397937, -0.25131683246049724]], [6, [6.36240681976344, -2.577176996318085, 1.3177409026840963]], [6, [2.089241380052104, -1.5866892584643533, 2.313323375590873]], [1, [-2.15409712751351, -0.9558363686830547, 1.1989326963927207]], [1, [-3.4295268721813543, -4.786750554955605, 2.266041508466581]], [1, [-2.443084143250611, -0.6908404782709564, 0.027370587323396665]], [1, [-1.235895207227637, -3.1581959004482902, 2.637113428608266]], [6, [-1.2111914921770552, -3.5647703042453474, -1.3134006980239443]], [4, [4.31769156546836, 0.10645014065940857, -1.3109613862645755]], [2, [-4.689960924911365, -0.5597519076654267, -2.580361892986448]], [6, [-0.35437990254689833, -3.1269253131993286, 0.8782086484217594]], [4, [-0.11400784710836559, 1.272295816057022, 0.5552258590256492]], [4, [3.185971810711859, 0.5638722464996142, -0.34250368717971647]], [6, [-0.2724980191053644, -4.166681931545724, -4.806259226607428]], [4, [-1.3481672932094573, 1.6886292808877803, -2.0370574121517016]], [1, [-1.7600011778872713, 0.7665394553631282, 2.231479830835215]], [6, [0.10984675215917293, -5.30762587255548, 3.1680335861406697]], [5, [1.1789252319767138, -0.006161286798443732, 0.6609739234115306]], [6, [3.9620480159448523, -0.448329781760276, 0.4540964910989775]], [6, [3.2385370155182107, -2.5410818017257877, 1.896989395061403]], [4, [0.6563017911174037, 3.4612036569484332, -1.9286621368099417]], [3, [-2.1815362872985076, -0.39315904335031426, -2.5162289881112803]], [6, [-0.6329816244731863, -2.3129088411990604, -0.38813255536745733]], [4, [-2.654529418592759, 1.889918696354055, -0.3097304880847043]], [4, [-1.498356290580856, 0.9255955189595102, -1.3753974798708615]], [1, [-2.8704109230353017, -0.7455178471627854, -0.5503658689026434]], [6, [-0.60907533023708, -3.290173962070363, -0.9433221030652865]], [6, [2.6025165758518143, -0.740038238483815, -0.6066703843526913]], [6, [5.120835229282251, -1.7745450078098077, 2.372916764243032]], [4, [-2.4260030067421208, 5.668234552078926, -0.06386275486410117]], [6, [-0.19953759965645532, -5.613251956839726, -1.7704614711647102]]]
        raw_centroids = [
            [0.11779463018299567, -0.3722088133802722, 0.03402894605372474], 
            [-1.4368960545101923, 0.19778558100028695, 1.9957168255849003], 
            [-2.525981071188719, -0.97187126121255, -1.6497991992939254], 
            [-1.0273762083730742, -0.33341492210411716, -2.525162685726134], 
            [0.7196073990232216, 2.177445365854891, -1.144344381754951], 
            [2.5708424311361164, 0.21200720200795709, 1.1913565485737212], 
            [1.1097683798819742, -2.4793567638273633, -0.045531305653556654]]
        
        kmeans_instance = KMeans(k = 7)
        samples = [elm[1] for elm in raw_sample_and_assigns]
        assigns = [elm[0] for elm in raw_sample_and_assigns]
        kmeans_instance.set_samples(samples)

        print 'process...'

        kmeans_instance.set_init_assign(assigns)
        kmeans_instance.set_centroids(raw_centroids)
        ok_(kmeans_instance.learn(steps = 2))

        assign_list = kmeans_instance.get_assign_list()
        print assign_list
        print [c.centroid for c in kmeans_instance.get_clusters()]
        
        """
        kmeans_instance.set_random_centroids()
        assign_list = kmeans_instance.get_assign_list()
        print assign_list
        print [c.centroid for c in kmeans_instance.get_clusters()]
            
        cnt = 0
        while not kmeans_instance.converged: 
            print cnt

            if cnt > 0:
                # 2個目のクエリからやる
                kmeans_instance = KMeans(k = 7)
                kmeans_instance.set_samples(samples)
                kmeans_instance.set_init_assign(assign_list)
                
                ok_(kmeans_instance.learn(steps = cnt))
                
            cnt += 1
            assign_list = kmeans_instance.get_assign_list()
            print assign_list
            print [c.centroid for c in kmeans_instance.get_clusters()]
            """

if __name__ == '__main__':
    unittest.main()


